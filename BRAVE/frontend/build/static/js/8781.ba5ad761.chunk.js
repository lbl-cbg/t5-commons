"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[8781],{98781:(e,t,n)=>{n.d(t,{wD:()=>L});var i=n(91205),r=n.n(i),o=n(52631),a=n.n(o),s=n(26382),l=n(54856),c=n(43050);function d(e){if(e.greaterThan(Number.MAX_SAFE_INTEGER)||e.lessThan(Number.MIN_SAFE_INTEGER))throw new Error("integer overflow");return e.toNumber()}class h extends Error{}function f(e){if(e&&e.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");{const e=new h("aborted");throw e.code="ERR_ABORTED",e}}}function u(e,t){const n=[];let i=null;return 0===e.length?e:(e.sort((function(e,t){const n=e.minv.blockPosition-t.minv.blockPosition;return 0!==n?n:e.minv.dataPosition-t.minv.dataPosition})),e.forEach((e=>{var r,o;(!t||e.maxv.compareTo(t)>0)&&(null===i?(n.push(e),i=e):(r=i,(o=e).minv.blockPosition-r.maxv.blockPosition<65e3&&o.maxv.blockPosition-r.minv.blockPosition<5e6?e.maxv.compareTo(i.maxv)>0&&(i.maxv=e.maxv):(n.push(e),i=e)))})),n)}var m=n(77353),p=n.n(m);class w{constructor(e,t){this.blockPosition=e,this.dataPosition=t}toString(){return"".concat(this.blockPosition,":").concat(this.dataPosition)}compareTo(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}static min(){let e,t=0;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(;!e;t+=1)e=i[t];for(;t<i.length;t+=1)e.compareTo(i[t])>0&&(e=i[t]);return e}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])throw new Error("big-endian virtual file offsets not implemented");return new w(1099511627776*e[t+7]+4294967296*e[t+6]+16777216*e[t+5]+65536*e[t+4]+256*e[t+3]+e[t+2],e[t+1]<<8|e[t])}class g{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;this.minv=e,this.maxv=t,this.bin=n,this._fetchedSize=i}toUniqueString(){return"".concat(this.minv,"..").concat(this.maxv," (bin ").concat(this.bin,", fetchedSize ").concat(this.fetchedSize(),")")}toString(){return this.toUniqueString()}compareTo(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}fetchedSize(){return void 0!==this._fetchedSize?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}class b{constructor(e){let{filehandle:t,renameRefSeqs:n=(e=>e)}=e;this.filehandle=t,this.renameRefSeq=n}async getMetadata(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{indices:t,...n}=await this.parse(e);return n}_findFirstData(e,t){return e?e.compareTo(t)>0?t:e:t}async parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.parseP||(this.parseP=this._parse(e).catch((e=>{throw this.parseP=void 0,e}))),this.parseP}async hasRefSeq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return!!(null===(n=(await this.parse(t)).indices[e])||void 0===n?void 0:n.binIndex)}}class x extends b{async lineCount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.parse(t);if(!n)return-1;const i=n.refNameToId[e];if(!n.indices[i])return-1;const{stats:r}=n.indices[i];return r?r.lineCount:-1}async _parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await this.filehandle.readFile(e),n=await(0,c.unzip)(t);if(f(e.signal),21578324!==n.readUInt32LE(0))throw new Error("Not a TBI file");const i=n.readInt32LE(4),r=n.readInt32LE(8),o=65536&r?"zero-based-half-open":"1-based-closed",a={0:"generic",1:"SAM",2:"VCF"}[15&r];if(!a)throw new Error("invalid Tabix preset format flags ".concat(r));const s={ref:n.readInt32LE(12),start:n.readInt32LE(16),end:n.readInt32LE(20)},l=n.readInt32LE(24),d=37449,h=l?String.fromCharCode(l):null,u=n.readInt32LE(28),m=n.readInt32LE(32),{refNameToId:p,refIdToName:w}=this._parseNameBytes(n.slice(36,36+m));let b,x=36+m;return{indices:new Array(i).fill(0).map((()=>{const e=n.readInt32LE(x);x+=4;const t={};let i;for(let a=0;a<e;a+=1){const e=n.readUInt32LE(x);if(x+=4,e>37450)throw new Error("tabix index contains too many bins, please use a CSI index");if(37450===e){const e=n.readInt32LE(x);x+=4,2===e&&(i=this.parsePseudoBin(n,x)),x+=16*e}else{const i=n.readInt32LE(x);x+=4;const r=new Array(i);for(let t=0;t<i;t+=1){const i=v(n,x),o=v(n,x+8);x+=16,b=this._findFirstData(b,i),r[t]=new g(i,o,e)}t[e]=r}}const r=n.readInt32LE(x);x+=4;const o=new Array(r);for(let a=0;a<r;a+=1)o[a]=v(n,x),x+=8,b=this._findFirstData(b,o[a]);return{binIndex:t,linearIndex:o,stats:i}})),metaChar:h,maxBinNumber:d,maxRefLength:536870912,skipLines:u,firstDataLine:b,columnNumbers:s,coordinateType:o,format:a,refIdToName:w,refNameToId:p,maxBlockSize:65536}}parsePseudoBin(e,t){return{lineCount:d(p().fromBytesLE(e.slice(t+16,t+24),!0))}}_parseNameBytes(e){let t=0,n=0;const i=[],r={};for(let o=0;o<e.length;o+=1)if(!e[o]){if(n<o){let a=e.toString("utf8",n,o);a=this.renameRefSeq(a),i[t]=a,r[a]=t}n=o+1,t+=1}return{refNameToId:r,refIdToName:i}}async blocksForRange(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t<0&&(t=0);const r=await this.parse(i);if(!r)return[];const o=r.refNameToId[e],a=r.indices[o];if(!a)return[];(a.linearIndex.length?a.linearIndex[t>>14>=a.linearIndex.length?a.linearIndex.length-1:t>>14]:new w(0,0))||console.warn("querying outside of possible tabix range");const s=(l=t,c=n,[[0,0],[1+((l+=1)>>26),1+((c-=1)>>26)],[9+(l>>23),9+(c>>23)],[73+(l>>20),73+(c>>20)],[585+(l>>17),585+(c>>17)],[4681+(l>>14),4681+(c>>14)]]);var l,c;const d=[];for(const[u,w]of s)for(let e=u;e<=w;e++)if(a.binIndex[e])for(const t of a.binIndex[e])d.push(new g(t.minv,t.maxv,e));const h=a.linearIndex.length;let f=null;const m=Math.min(t>>14,h-1),p=Math.min(n>>14,h-1);for(let u=m;u<=p;++u){const e=a.linearIndex[u];e&&(!f||e.compareTo(f)<0)&&(f=e)}return u(d,f)}}function I(e,t){return Math.floor(e/2**t)}class E extends b{constructor(e){super(e),this.maxBinNumber=0,this.depth=0,this.minShift=0}async lineCount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.parse(t);if(!n)return-1;const i=n.refNameToId[e];if(!n.indices[i])return-1;const{stats:r}=n.indices[i];return r?r.lineCount:-1}indexCov(){throw new Error("CSI indexes do not support indexcov")}parseAuxData(e,t){const n=e.readInt32LE(t),i=65536&n?"zero-based-half-open":"1-based-closed",r={0:"generic",1:"SAM",2:"VCF"}[15&n];if(!r)throw new Error("invalid Tabix preset format flags ".concat(n));const o={ref:e.readInt32LE(t+4),start:e.readInt32LE(t+8),end:e.readInt32LE(t+12)},a=e.readInt32LE(t+16),s=a?String.fromCharCode(a):null,l=e.readInt32LE(t+20),c=e.readInt32LE(t+24),{refIdToName:d,refNameToId:h}=this._parseNameBytes(e.slice(t+28,t+28+c));return{refIdToName:d,refNameToId:h,skipLines:l,metaChar:s,columnNumbers:o,format:r,coordinateType:i}}_parseNameBytes(e){let t=0,n=0;const i=[],r={};for(let o=0;o<e.length;o+=1)if(!e[o]){if(n<o){let a=e.toString("utf8",n,o);a=this.renameRefSeq(a),i[t]=a,r[a]=t}n=o+1,t+=1}return{refNameToId:r,refIdToName:i}}async _parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await(0,c.unzip)(await this.filehandle.readFile(e));let n;if(21582659===t.readUInt32LE(0))n=1;else{if(38359875!==t.readUInt32LE(0))throw new Error("Not a CSI file");n=2}this.minShift=t.readInt32LE(4),this.depth=t.readInt32LE(8),this.maxBinNumber=((1<<3*(this.depth+1))-1)/7;const i=2**(this.minShift+3*this.depth),r=t.readInt32LE(12),o=r&&r>=30?this.parseAuxData(t,16):{refIdToName:[],refNameToId:{},metaChar:null,columnNumbers:{ref:0,start:1,end:2},coordinateType:"zero-based-half-open",format:"generic"},a=t.readInt32LE(16+r);let s,l=16+r+4;const d=new Array(a).fill(0).map((()=>{const e=t.readInt32LE(l);l+=4;const n={};let i;for(let r=0;r<e;r+=1){const e=t.readUInt32LE(l);if(e>this.maxBinNumber)i=this.parsePseudoBin(t,l+4),l+=48;else{const i=v(t,l+4);s=this._findFirstData(s,i);const r=t.readInt32LE(l+12);l+=16;const o=new Array(r);for(let n=0;n<r;n+=1){const i=v(t,l),r=v(t,l+8);l+=16,o[n]=new g(i,r,e)}n[e]=o}}return{binIndex:n,stats:i}}));return{...o,csi:!0,refCount:a,maxBlockSize:65536,firstDataLine:s,csiVersion:n,indices:d,depth:this.depth,maxBinNumber:this.maxBinNumber,maxRefLength:i}}parsePseudoBin(e,t){return{lineCount:d(p().fromBytesLE(e.slice(t+28,t+36),!0))}}async blocksForRange(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t<0&&(t=0);const r=await this.parse(i);if(!r)return[];const o=r.refNameToId[e],a=r.indices[o];if(!a)return[];const s=this.reg2bins(t,n),l=[];for(const[c,d]of s)for(let e=c;e<=d;e++)if(a.binIndex[e])for(const t of a.binIndex[e])l.push(new g(t.minv,t.maxv,e));return u(l,new w(0,0))}reg2bins(e,t){(e-=1)<1&&(e=1),t>2**50&&(t=2**34),t-=1;let n=0,i=0,r=this.minShift+3*this.depth;const o=[];for(;n<=this.depth;r-=3,i+=1*2**(3*n),n+=1){const n=i+I(e,r),a=i+I(t,r);if(a-n+o.length>this.maxBinNumber)throw new Error("query ".concat(e,"-").concat(t," is too large for current binning scheme (shift ").concat(this.minShift,", depth ").concat(this.depth,"), try a smaller query or a coarser index binning scheme"));o.push([n,a])}return o}}const S="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function T(e){return new Promise((t=>setTimeout(t,e)))}class L{constructor(e){let{path:t,filehandle:n,tbiPath:i,tbiFilehandle:o,csiPath:s,csiFilehandle:c,yieldTime:d=500,chunkSizeLimit:h=5e7,renameRefSeqs:f=(e=>e),chunkCacheSize:u=5242880}=e;if(n)this.filehandle=n;else{if(!t)throw new TypeError("must provide either filehandle or path");this.filehandle=new l.LocalFile(t)}if(o)this.index=new x({filehandle:o,renameRefSeqs:f});else if(c)this.index=new E({filehandle:c,renameRefSeqs:f});else if(i)this.index=new x({filehandle:new l.LocalFile(i),renameRefSeqs:f});else if(s)this.index=new E({filehandle:new l.LocalFile(s),renameRefSeqs:f});else{if(!t)throw new TypeError("must provide one of tbiFilehandle, tbiPath, csiFilehandle, or csiPath");this.index=new x({filehandle:new l.LocalFile("".concat(t,".tbi")),renameRefSeqs:f})}this.chunkSizeLimit=h,this.renameRefSeq=f,this.yieldTime=d,this.chunkCache=new(r())({cache:new(a())({maxSize:Math.floor(u/65536)}),fill:(e,t)=>this.readChunk(e,{signal:t})})}async getLines(e,t,n,i){var r;let o,a,s={};if(void 0===i)throw new TypeError("line callback must be provided");if("function"===typeof i?a=i:(s=i,a=i.lineCallback,o=i.signal),void 0===e)throw new TypeError("must provide a reference sequence name");if(!a)throw new TypeError("line callback must be provided");const l=await this.index.getMetadata(s);f(o);const c=null!==t&&void 0!==t?t:0,d=null!==n&&void 0!==n?n:l.maxRefLength;if(!(c<=d))throw new TypeError("invalid start and end coordinates. start must be less than or equal to end");if(c===d)return;const h=await this.index.blocksForRange(e,c,d,s);f(o);for(const f of h){const e=f.fetchedSize();if(e>this.chunkSizeLimit)throw new Error("Too much data. Chunk size ".concat(e.toLocaleString()," bytes exceeds chunkSizeLimit of ").concat(this.chunkSizeLimit.toLocaleString(),"."))}let u=Date.now();for(const m of h){let t;const{buffer:n,cpositions:i,dpositions:s}=await this.chunkCache.get(m.toString(),m,o);f(o);let h=0,p=0;for(;h<n.length;){const w=n.indexOf("\n",h);if(-1===w)break;const v=n.slice(h,w),g=null!==(r=null===S||void 0===S?void 0:S.decode(v))&&void 0!==r?r:v.toString();if(s){for(;h+m.minv.dataPosition>=s[p++];);p--}const{startCoordinate:b,overlaps:x}=this.checkLine(l,e,c,d,g);if(void 0!==t&&void 0!==b&&t>b)throw new Error("Lines not sorted by start coordinate (".concat(t," > ").concat(b,"), this file is not usable with Tabix."));if(t=b,x)a(g.trim(),256*i[p]+(h-s[p])+m.minv.dataPosition+1);else if(void 0!==b&&b>=d)return;this.yieldTime&&u-Date.now()>this.yieldTime&&(u=Date.now(),f(o),await T(1)),h=w+1}}}async getMetadata(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.index.getMetadata(e)}async getHeaderBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{firstDataLine:t,metaChar:n,maxBlockSize:i}=await this.getMetadata(e);f(e.signal);const r=((null===t||void 0===t?void 0:t.blockPosition)||0)+i,o=await this._readRegion(0,r,e),a=await(0,c.unzip)(o);if(n){let e=-1;const t="\n".charCodeAt(0),i=n.charCodeAt(0);for(let n=0;n<a.length&&(n!==e+1||a[n]===i);n+=1)a[n]===t&&(e=n);return a.slice(0,e+1)}return a}async getHeader(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await this.getHeaderBuffer(e)).toString("utf8")}async getReferenceSequenceNames(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await this.getMetadata(e)).refIdToName}checkLine(e,t,n,i,r){const{columnNumbers:o,metaChar:a,coordinateType:s,format:l}=e;if(a&&r.startsWith(a))return{overlaps:!1};let{ref:c,start:d,end:h}=o;c||(c=0),d||(d=0),h||(h=0),"VCF"===l&&(h=8);const f=Math.max(c,d,h);let u=1,m=0,p="",w=-1/0;for(let v=0;v<r.length+1;v+=1)if("\t"===r[v]||v===r.length){if(u===c){if(this.renameRefSeq(r.slice(m,v))!==t)return{overlaps:!1}}else if(u===d){if(w=parseInt(r.slice(m,v),10),"1-based-closed"===s&&(w-=1),w>=i)return{startCoordinate:w,overlaps:!1};if((0===h||h===d)&&w+1<=n)return{startCoordinate:w,overlaps:!1}}else if("VCF"===l&&4===u)p=r.slice(m,v);else if(u===h){if(("VCF"===l?this._getVcfEnd(w,p,r.slice(m,v)):parseInt(r.slice(m,v),10))<=n)return{overlaps:!1}}if(m=v+1,u+=1,u>f)break}return{startCoordinate:w,overlaps:!0}}_getVcfEnd(e,t,n){let i=e+t.length;const r=n.includes("SVTYPE=TRA");if("."===n[0]||r){if(r)return e+1}else{let e=";";for(let t=0;t<n.length;t+=1){if(";"===e&&"END="===n.slice(t,t+4)){let e=n.indexOf(";",t);-1===e&&(e=n.length),i=parseInt(n.slice(t+4,e),10);break}e=n[t]}}return i}async lineCount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.index.lineCount(e,t)}async _readRegion(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=s.Buffer.alloc(t),{bytesRead:r,buffer:o}=await this.filehandle.read(i,0,t,e,n);return o.slice(0,r)}async readChunk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this._readRegion(e.minv.blockPosition,e.fetchedSize(),t);return(0,c.unzipChunkSlice)(n,e)}}}}]);
//# sourceMappingURL=8781.ba5ad761.chunk.js.map