"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1562],{71562:(t,e,r)=>{r.d(e,{makeImageData:()=>m});var o=r(98779),a=r(95629),n=r(91775);function c(t,e,r,o,a,n,c){e+o<0||e>n||(c&&(t.fillStyle=c),t.fillRect(e,r,o,a))}function i(t){const{bases:e}=t.palette;return{A:e.A.main,C:e.C.main,G:e.G.main,T:e.T.main,deletion:"#808080"}}function s(){return{charWidth:(0,n.measureText)("A"),charHeight:(0,n.measureText)("M")-2}}var l=r(23746),f=r(93963);function d(t,e){return l.pf[function(t,e){const r=(0,o.readConfObject)(e,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[f.il[r][t.get("pair_orientation")]]}(t,e)||"color_nostrand"]}function h(t){let{colorType:e,tag:r,feature:a,config:n,defaultColor:c,colorTagMap:i}=t;switch(e){case"insertSize":return function(t){return t.get("is_paired")&&t.get("refName")!==t.get("next_ref")?"#555":"hsl(".concat(Math.abs(t.get("template_length"))/10,",50%,50%)")}(a);case"strand":return function(t){return-1===t.get("strand")?"#8F8FD8":"#EC8B8B"}(a);case"mappingQuality":return function(t){return"hsl(".concat(t.get("score"),",50%,50%)")}(a);case"pairOrientation":return d(a,n);case"stranded":return function(t){return l.pf[function(t){const e=t.get("flags"),r=t.get("strand");if(1&e){const o=64&e?-1:1;return 2&e?r*o===1?"color_rev_strand":"color_fwd_strand":8&e?r*o===1?"color_rev_missing_mate":"color_fwd_missing_mate":t.get("refName")===t.get("next_ref")?r*o===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(t)]}(a);case"xs":case"tag":{const t=a.get("tags"),e=t?t[r]:a.get(r);return"XS"===r||"TS"===r?l.pf[{"-":"color_rev_strand","+":"color_fwd_strand"}[e]||"color_nostrand"]:"ts"===r?l.pf[{"-":-1===a.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===a.get("strand")?"color_rev_strand":"color_fwd_strand"}[e]||"color_nostrand"]:i[e]||l.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&a.get("flags")?"#c8dcc8":"#c8c8c8";default:return c?"lightgrey":(0,o.readConfObject)(n,"color",{feature:a})}}var g=r(61959);var p=r(93022);function u(t){let{ctx:e,feat:r,renderArgs:o,colorForBase:a,contrastForBase:i,charWidth:s,charHeight:l,defaultColor:d,canvasWidth:u}=t;const{config:x,bpPerPx:b,regions:m,colorBy:P,colorTagMap:_={}}=o,{tag:v="",type:S=""}=P||{},{feature:y}=r,T=m[0];switch(e.fillStyle=h({feature:y,config:x,tag:v,defaultColor:d,colorType:S,colorTagMap:_}),function(t){let{ctx:e,feat:r,renderArgs:o}=t;const{regions:a,bpPerPx:c}=o,{heightPx:i,topPx:s,feature:l}=r,[f]=a,d=l.get("start"),h=l.get("end"),[g,p]=(0,n.bpSpanPx)(d,h,f,c),u=f.reversed?-1:1,x=l.get("strand")*u;c<10&&i>5?-1===x?(e.beginPath(),e.moveTo(g-5,s+i/2),e.lineTo(g,s+i),e.lineTo(p,s+i),e.lineTo(p,s),e.lineTo(g,s),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(g,s),e.lineTo(g,s+i),e.lineTo(p,s+i),e.lineTo(p+5,s+i/2),e.lineTo(p,s),e.closePath(),e.fill()):e.fillRect(g,s,p-g,i)}({ctx:e,feat:r,renderArgs:o}),S){case"perBaseQuality":!function(t){let{ctx:e,feat:r,region:o,bpPerPx:a,canvasWidth:i}=t;const{feature:s,topPx:l,heightPx:f}=r,d=(s.get("qual")||"").split(" ").map((t=>+t)),h=(0,g.eL)(s.get("CIGAR")),p=1/a,u=s.get("start");let x=0,b=0;for(let g=0;g<h.length;g+=2){const t=+h[g],r=h[g+1];if("S"===r||"I"===r)x+=t;else if("D"===r||"N"===r)b+=t;else if("M"===r||"X"===r||"="===r){for(let r=0;r<t;r++){const t=d[x+r],s=u+b+r;c(e,(0,n.bpSpanPx)(s,s+1,o,a)[0],l,p+.5,f,i,"hsl(".concat(255===t?150:1.5*t,",55%,50%)"))}x+=t,b+=t}}}({ctx:e,feat:r,region:T,bpPerPx:b,canvasWidth:u});break;case"perBaseLettering":!function(t){let{ctx:e,feat:r,region:o,bpPerPx:a,colorForBase:i,contrastForBase:s,charWidth:l,charHeight:f,canvasWidth:d}=t;const h=f-2,{feature:p,topPx:u,heightPx:x}=r,b=p.get("seq"),m=(0,g.eL)(p.get("CIGAR")),P=1/a,_=p.get("start");let v=0,S=0;if(b)for(let g=0;g<m.length;g+=2){const t=+m[g],r=m[g+1];if("S"===r||"I"===r)v+=t;else if("D"===r||"N"===r)S+=t;else if("M"===r||"X"===r||"="===r){for(let r=0;r<t;r++){const t=b[v+r],f=_+S+r,[g]=(0,n.bpSpanPx)(f,f+1,o,a);c(e,g,u,P+.5,x,d,i[t]),P>=l&&x>=h&&(e.fillStyle=s[t],e.fillText(t,g+(P-l)/2+1,u+x))}v+=t,S+=t}}}({ctx:e,feat:r,region:T,bpPerPx:b,colorForBase:a,contrastForBase:i,charWidth:s,charHeight:l,canvasWidth:u});break;case"modifications":!function(t){let{ctx:e,feat:r,region:o,bpPerPx:a,renderArgs:i,canvasWidth:s}=t;const{feature:l,topPx:d,heightPx:h}=r,{modificationTagMap:u={}}=i,x=l.get("seq");if(!x)return;const b=(0,f.c$)(l,"MM","Mm")||"",m=l.get("CIGAR"),P=l.get("start"),_=l.get("strand"),v=(0,g.eL)(m),S=(0,g.wg)(l),y=(0,g.xA)(b,x,_);let T=0;for(const{type:f,positions:W}of y){const t=u[f]||"black",r=(0,p.colord)(t);for(const i of(0,g.hn)(v,W)){const l=P+i,[f,g]=(0,n.bpSpanPx)(l,l+1,o,a),p=(null===S||void 0===S?void 0:S[T])||0;c(e,f,d,g-f+.5,h,s,1!==p?r.alpha(p+.1).toHslString():t),T++}}}({ctx:e,feat:r,region:T,bpPerPx:b,renderArgs:o,canvasWidth:u});break;case"methylation":!function(t){let{ctx:e,feat:r,region:o,bpPerPx:a,renderArgs:i,canvasWidth:s}=t;var l,f;const{regionSequence:d}=i,{feature:h,topPx:u,heightPx:x}=r;if(!d)throw new Error("region sequence required for methylation");if(!h.get("seq"))return;const b=h.get("start"),m=h.get("end"),{methBins:P,methProbs:_}=(0,g.Ps)(h);function v(t){if(P[t]){const e=_[t]||0;return(e>.5?(0,p.colord)("red").alpha(2*(e-.5)):(0,p.colord)("blue").alpha(1-2*e)).toHslString()}}for(let g=0;g<m-b;g++){const t=g+b,r=null===(l=d[t-o.start+1])||void 0===l?void 0:l.toLowerCase(),i=null===(f=d[t-o.start+2])||void 0===f?void 0:f.toLowerCase();if("c"===r&&"g"===i)if(a>2){const[r,i]=(0,n.bpSpanPx)(t,t+2,o,a);c(e,r,u,i-r+.5,x,s,v(g)||v(g+1)||"blue")}else{const[r,i]=(0,n.bpSpanPx)(t,t+1,o,a);c(e,r,u,i-r+.5,x,s,v(g)||"blue");const[l,f]=(0,n.bpSpanPx)(t+1,t+2,o,a);c(e,l,u,f-l+.5,x,s,v(g+1)||"blue")}}}({ctx:e,feat:r,region:T,bpPerPx:b,renderArgs:o,canvasWidth:u})}}function x(t){let{ctx:e,feat:r,renderArgs:o,minSubfeatureWidth:a,largeInsertionIndicatorScale:i,mismatchAlpha:s,charWidth:l,charHeight:f,colorForBase:d,contrastForBase:h,canvasWidth:g,drawSNPsMuted:u,drawIndels:x=!0}=t;const{bpPerPx:b,regions:m}=o,{heightPx:P,topPx:_,feature:v}=r,[S]=m,y=v.get("start"),T=Math.min(1/b,2),W=v.get("mismatches"),w=f-2,A=S.reversed?1/b+1:-1;if(W){for(const t of W){const r=y+t.start,o=t.length,i=t.base,[f,m]=(0,n.bpSpanPx)(r,r+o,S,b),v=Math.max(a,Math.abs(f-m));if("mismatch"===t.type){if(!u){const r=d[t.base]||"#888",o=s?void 0===t.qual?r:(0,p.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r;c(e,Math.round(f),_,v,P,g,o)}if(v>=l&&P>=w){const r=u?"black":h[t.base]||"black";e.fillStyle=s?void 0===t.qual?r:(0,p.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r,e.fillText(i,f+(v-l)/2+1,_+P)}}else if("deletion"===t.type&&x){c(e,f,_,Math.abs(f-m),P,g,d.deletion);const r="".concat(t.length),o=(0,n.measureText)(r,10);v>=o&&P>=w&&(e.fillStyle=h.deletion,e.fillText(r,(f+m)/2-o/2,_+P))}else if("insertion"===t.type&&x){e.fillStyle="purple";const r=f+A,o=+t.base||t.length,a=Math.max(0,Math.min(1.2,1/b));if(o<10&&(c(e,r,_,a,P,g,"purple"),1/b>=l&&P>=w)){const o=r-a;c(e,o,_,3*a,1,g),c(e,o,_+P-1,3*a,1,g),e.fillText("(".concat(t.base,")"),r+3,_+P)}}else if("hardclip"===t.type||"softclip"===t.type){const r=f+A,o="hardclip"===t.type?"red":"blue",n=Math.max(a,T);if(c(e,r,_,n,P,g,o),1/b>=l&&P>=w){const o=r-n;c(e,o,_,3*n,1,g),c(e,o,_+P-1,3*n,1,g),e.fillText("(".concat(t.base,")"),r+3,_+P)}}else if("skip"===t.type&&f+v>0){const t=v-(b>10?1.5:0);e.clearRect(f,_,t,P),c(e,Math.max(0,f),_+P/2-1,t+(f<0?f:0),2,g,"#333")}}if(x)for(const t of W){const r=y+t.start,o=t.length,[a]=(0,n.bpSpanPx)(r,r+o,S,b),s=+t.base||t.length,l="".concat(s);if("insertion"===t.type&&s>=10)if(b>i)c(e,a-1,_,2,P,g,"purple");else if(P>f){const t=(0,n.measureText)(l),r=5;c(e,a-t/2-r,_,t+2*r,P,g,"purple"),e.fillStyle="white",e.fillText(l,a-t/2,_+P)}else{const t=2;c(e,a-t,_,2*t,P,g,"purple")}}}}function b(t){let{ctx:e,feat:r,renderArgs:a,config:i,theme:l,colorForBase:f,canvasWidth:d}=t;const{feature:h,topPx:g,heightPx:p}=r,{regions:u,bpPerPx:x}=a,[b]=u,m=(0,o.readConfObject)(i,"minSubfeatureWidth"),P=h.get("mismatches"),_=h.get("seq"),{charWidth:v,charHeight:S}=s();if(!_||!P)return;const y=S-2;for(const o of P)if("softclip"===o.type){const t=o.cliplen||0,r=h.get("start"),a=0===o.start?r-t:r+o.start;for(let i=0;i<t;i+=1){const t=_.charAt(i+o.start);if(!t)return;const r=a+i,[s,h]=(0,n.bpSpanPx)(r,r+1,b,x),u=Math.max(m,h-s),P=f[t]||"#000000";e.fillStyle=P,c(e,s,g,u,p,d),u>=v&&p>=y&&(e.fillStyle=l.palette.getContrastText(P),e.fillText(t,s+(u-v)/2+1,g+p))}}}function m(t){let{ctx:e,layoutRecords:r,canvasWidth:n,renderArgs:c}=t;const{config:l,showSoftClip:f,colorBy:d,theme:h}=c,g=(0,o.readConfObject)(l,"mismatchAlpha"),p=(0,o.readConfObject)(l,"minSubfeatureWidth"),m=(0,o.readConfObject)(l,"largeInsertionIndicatorScale"),P="#f0f"===(0,o.readConfObject)(l,"color"),_=(0,a.createJBrowseTheme)(h),v=i(_),S=function(t){return Object.fromEntries(Object.entries(i(t)).map((e=>{let[r,o]=e;return[r,t.palette.getContrastText(o)]})))}(_);e.font="bold 10px Courier New,monospace";const{charWidth:y,charHeight:T}=s(),W=(w=null===d||void 0===d?void 0:d.type,["methylation","modifications"].includes(w||""));var w;for(const o of r)u({ctx:e,feat:o,renderArgs:c,defaultColor:P,colorForBase:v,contrastForBase:S,charWidth:y,charHeight:T,canvasWidth:n}),x({ctx:e,feat:o,renderArgs:c,mismatchAlpha:g,drawSNPsMuted:W,drawIndels:true,largeInsertionIndicatorScale:m,minSubfeatureWidth:p,charWidth:y,charHeight:T,colorForBase:v,contrastForBase:S,canvasWidth:n}),f&&b({ctx:e,feat:o,renderArgs:c,colorForBase:v,config:l,theme:_,canvasWidth:n})}}}]);
//# sourceMappingURL=1562.994068d8.chunk.js.map